<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>





    <-- Include jQuery -->
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->

    <!-- Include Bootstrap JS (3.3.7) -->
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> -->

    <!-- Include MDB JS (6.4.2) -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.js"></script> -->


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- //Meta tag Keywords -->
    <!-- Custom-Files -->
    <!-- <link rel="stylesheet" href="/bootstrap.css"> -->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Bootstrap-Core-CSS -->
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="all" >
    <!-- Style-CSS -->
    <!-- font-awesome-icons -->
    <link href="/css/font-awesome.css" rel="stylesheet">
    <!-- //font-awesome-icons -->
    <!-- /Fonts -->
    <link href="//fonts.googleapis.com/css?family=Hind:300,400,500,600,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- //Fonts -->

</head>
<body>
  <div class="main-sec inner-page">
    <!-- //header -->
    <header class="py-sm-3 pt-3 pb-2" id="home">
        <div class="container">
            <!-- nav -->
            <div class="top-w3pvt d-flex">
                <div id="logo">
                    <h1> <a href="index.html"><span class="log-w3pvt">B</span>cart</a> <label class="sub-des">Online Store</label></h1>
                </div>

                <div class="forms ml-auto">
                    <a href="/login" class="btn"><span class="fa fa-user-circle-o"></span> Sign In</a>
                    <a href="/signup" class="btn"><span ><i class="fa-solid fa-user-plus"></i></span> Sign Up</a>
                </div>
            </div>
            <div class="nav-top-wthree">
                <nav>
                    <label for="drop" class="toggle"><span class="fa fa-bars"></span></label>
                    <input type="checkbox" id="drop" >
                    <ul class="menu">
                        <li><a href="/home">Home</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li >
                            <!-- First Tier Drop Down -->
                            <a href="/cart">Cart</a>

                        </li>

                        <li><a href="/products">Collections</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </nav>
                <!-- //nav -->
                <div class="search-form ml-auto">
                    <div class="form-w3layouts-grid">
                        <form action="#" method="post" class="newsletter">
                            <input class="search" type="search" placeholder="Search here..." required="">
                            <button class="form-control btn" value=""><span class="fa fa-search"></span></button>

                        </form>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </header>
    <!-- //header -->
</div>

      <section class="bg-light py-5">
        <div class="container">
          <div class="row">
            <div class="col-xl-8 col-lg-8 mb-4">
              <!-- Checkout -->
              <div class="card shadow-0 border">
                <div class="p-4">
                  <h5 class="card-title mb-3">Add Address</h5>
                  <!-- <button type="button" class="btn btn-primary" data-mdb-toggle="modal" data-mdb-target="#exampleModal" data-whatever="@getbootstrap">Open modal for @getbootstrap</button>

                  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">New message</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <form id="form-data">
                            <div class="mb-3">
                              <label for="Street" class="form-label">Street</label>
                              <input type="text" class="form-control" id="street" name="street">
                            </div>
                            <div class="mb-3">
                              <label for="city" class="form-label">City</label>
                              <input type="text" class="form-control" id="city" name="city">
                            </div>
                            <div class="mb-3">
                              <label for="State" class="form-label">State</label>
                              <input type="text" class="form-control" id="state" name="state">
                            </div>
                            <div class="mb-3">
                              <label for="Pincode" class="form-label"> Pincode</label>
                              <input type="text" class="form-control" id="pincode" name="pincode">
                            </div>
                            <div class="mb-3">
                              <label for="Country" class="form-label">Country</label>
                              <input type="text" class="form-control" id="country" name="country">
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                              <button type="submit" class="btn btn-primary">Send message</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div> -->

                  <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
  Add Address
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add a new Address</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <form id="form-data">
          <div class="mb-3">
            <label for="Street" class="form-label">Street</label>
            <input type="text" class="form-control" id="street" name="street">
          </div>
          <div class="mb-3">
            <label for="city" class="form-label">City</label>
            <input type="text" class="form-control" id="city" name="city">
          </div>
          <div class="mb-3">
            <label for="State" class="form-label">State</label>
            <input type="text" class="form-control" id="state" name="state">
          </div>
          <div class="mb-3">
            <label for="Pincode" class="form-label"> Pincode</label>
            <input type="text" class="form-control" id="pincode" name="pincode">
          </div>
          <div class="mb-3">
            <label for="Country" class="form-label">Country</label>
            <input type="text" class="form-control" id="country" name="country">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Add Address</button>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>



                  <hr class="my-4" />

                  <h5 class="card-title mb-3"> Address</h5>
                  <% for( let i = 0; i < address.length; i++ ) { %>
                    <div class="row mb-3">
                        <div class="col-lg-4 mb-3">
                          <!-- Default checked radio -->

                            <div class="form-check h-100 border rounded-3">
                              <div class="p-3">
                                <input class="form-check-input" type="radio" name="flexRadioDefault" data-address-id="<%= address[i]._id %>" id="flexRadioDefault1" checked />
                                <label class="form-check-label" for="flexRadioDefault1">
                                      Street:<%= address[i].street %> <br>
                                        City: <%= address[i].city %><br>
                                        State: <%= address[i].state %> <br>
                                        Country: <%= address[i].country %> <br>
                                        Pincode:<%= address[i].pincode  %> <br>
                                </label>
                              </div>
                            </div>


                        </div>
                      </div>

                  <% } %>




                </div>
              </div>
              <!-- Checkout -->
            </div>
            <div class="col-xl-4 col-lg-4 d-flex justify-content-center justify-content-lg-end">
              <div class="ms-lg-4 mt-4 mt-lg-0" style="max-width: 320px;">
                <h6 class="mb-3">Summary</h6>
                <div class="d-flex justify-content-between">
                  <p class="mb-2">Total price:</p>
                  <p class="mb-2"><%= product.totalPrice  %></p>
                </div>
                <div class="d-flex justify-content-between">
                  <p class="mb-2">Discount:</p>
                  <p class="mb-2 text-danger">- $60.00</p>
                </div>
                <div class="d-flex justify-content-between">
                  <p class="mb-2">Shipping cost:</p>
                  <p class="mb-2">+ $14.00</p>
                </div>
                <hr />
                <div class="d-flex justify-content-between">
                  <p class="mb-2">Total price:</p>
                  <p class="mb-2 fw-bold"><%= product.totalPrice  %></p>
                </div>

                <div class="input-group mt-3 mb-4">
                  <input type="text" class="form-control border" name="" placeholder="Promo code" />
                  <button class="btn btn-light text-primary border">Apply</button>
                </div>

                <hr />
                <h6 class="text-dark my-4">Items in cart</h6>

                <% userproduct.forEach(product => { %>
                  <div class="d-flex align-items-center mb-4">
                    <div class="me-3 position-relative">
                      <img src="/uploads/<%= product.productId.productimage[0].filename %>" style="height: 96px; width: 96x;" class="img-sm rounded border" alt="" >
                    </div>
                    <div class="">
                     <p><%= product.productId.productname %></p>
                     <p><%= product.quantity %></p>
                    </div>
                  </div>

                <% }) %>
                <div class="price text-muted">Total Amount:<%= product.totalPrice  %>
                  </div>
                <div class="mb-3">
                  <label for="paymentMethod" class="form-label">Payment Method</label>
                  <select class="form-select" id="paymentMethod" name="paymentMethod">
                      <option value="cash">Cash on Delivery</option>
                      <option value="online">Online Payment</option>
                  </select>
              </div>
              <button type="button" id="button" class="btn btn-primary" >Purchase</button>
              </div>
            </div>
          </div>
        </div>

      </section>

      <!-- Footer -->
      <!-- Footer -->
      <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script> -->


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>

document.getElementById('form-data').addEventListener('submit',(event)=>{
  event.preventDefault();

  const street = document.getElementById('street').value;
            const city = document.getElementById('city').value;
            const state = document.getElementById('state').value;
            const pincode = document.getElementById('pincode').value;
            const country = document.getElementById('country').value;


const data={
  street:street,
  city:city,
  state:state,
  pincode:pincode,
  country:country
}

fetch('/addaddress',{
  method:'post',
  body:JSON.stringify(data),
  headers: {
        'Content-Type': 'application/json'
      }

}).then((response)=>{
  if(response.ok){
    window.location.reload();
    console.log("sucess");
  }
})
.catch((error)=>{
  console.log("error");
  console.log(error);
})

})


 const paymentMethod=document.getElementById('paymentMethod');
 if(!paymentMethod){
  alert("plz select a payment method");
 }



document.getElementById('button').addEventListener('click', (event) => {
  const addressId = document.querySelector('input[name="flexRadioDefault"]:checked').getAttribute('data-address-id');
  if (!addressId) {
    alert("Please select an address before proceeding.");
  } else {
    // Do something with the selectedAddressId, e.g., send it to your server for processing.

    console.log("Selected Address ID:",addressId );
    fetch(`/addorder/${addressId}`,{
      method:'post'
    }).then((res)=>{
      if(res.ok){
        window.location.href='/ordersucessfull'

      }else{
       console.log("error ocuurred no response")
      }
     
    }).catch((error)=>{
      console.log(error)
    })
  }
});








</script>

</body>
</html>